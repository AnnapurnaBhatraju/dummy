{% extends "react_base.html" %} {% block content %}

<div
  id="vanta-bg"
  data-type="birds"
  class="position-fixed w-100 h-100 top-0 start-0"
  style="z-index: -1"
></div>

<section
  class="min-vh-100 d-flex flex-column justify-content-start align-items-center pt-5"
>
  <div
    id="navbar-root"
    data-theme="light"
    data-logo="Anaemia Prediction"
    data-logo-position="left"
    data-nav-align="right"
    data-rounded="true"
    data-animate-type="animate__fadeInDown"
    data-nav-items='[
         {"name":"Dashboard","link":"/user/dashboard"},
         {"name":"Logout","link":"/"}
       ]'
  ></div>

  <div class="container my-5">
    <div class="card glass-card mx-auto p-4 shadow-lg" style="max-width: 500px">
      <h3 class="text-center text-danger fw-bold mb-3">
        <i class="fa-solid fa-heart-circle-check"></i> Anaemia Prediction
      </h3>

      <form action="{{ url_for('user.PredictAction') }}" method="POST">
        <label class="fw-bold">Gender</label>
        <select name="Gender" class="form-control mb-3" required>
          <option value="">Select Gender</option>
          <option value="1">Male</option>
          <option value="0">Female</option>
        </select>

        <label class="fw-bold">Hemoglobin</label>
        <input
          type="number"
          step="0.1"
          name="Hemoglobin"
          class="form-control mb-3"
          required
        />

        <label class="fw-bold">MCH</label>
        <input
          type="number"
          step="0.1"
          name="MCH"
          class="form-control mb-3"
          required
        />

        <label class="fw-bold">MCHC</label>
        <input
          type="number"
          step="0.1"
          name="MCHC"
          class="form-control mb-3"
          required
        />

        <label class="fw-bold">MCV</label>
        <input
          type="number"
          step="0.1"
          name="MCV"
          class="form-control mb-3"
          required
        />

        <div class="text-center">
          <button type="submit" class="btn btn-gradient fw-bold px-4 py-2">
            Predict
          </button>
        </div>
      </form>
    </div>
  </div>

  

{% if result %}
<div class="container mb-3" style="max-width: 500px">

  <div class="result-box fw-bold text-center p-4 
       {% if color == 'red' %}result-red{% else %}result-green{% endif %}">
    {{ result }}
  </div>

  {% if color == 'red' %}
  <div class="text-center mt-3">
    <button onclick="findNearbyHospitals()" 
       class="btn btn-warning px-4 py-2"
       style="border-radius: 10px; font-weight: bold;">
      Get Medical Help
    </button>
  </div>
  {% endif %}

  {% if confidence %}
  <p class="text-center text-white mt-3 fw-bold" style="font-size: 1.2rem">
      Confidence: <span style="color: #d00">{{ confidence }}%</span>
  </p>
  {% endif %}

</div>
{% endif %}

 {% if explanation %}
  <div class="container mb-5" style="max-width: 500px">
    <div class="card p-3 shadow-sm" style="border-radius: 12px">
      <h5 class="fw-bold text-center">Top Feature Contributions (SHAP)</h5>

      <ul class="list-group mt-2">
        {% for item in explanation %}
        <li
          class="list-group-item d-flex justify-content-between align-items-center"
        >
          <span style="font-weight: 600">{{ item.feature }}</span>

          <span
            style="font-weight:bold; color:
              {% if item.color=='green' %}#1c8e1c
              {% elif item.color=='yellow' %}#c7a400
              {% else %}#d62828{% endif %};
        "
          >
            {{ item.value }}
          </span>
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
  {% endif %}
</section>

<style>
  .glass-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    border-radius: 20px;
  }
  .result-box {
    border-radius: 15px;
    font-size: 1.3rem;
    color: white;
    box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.3);
  }
  .result-red {
    background-color: #e32636;
  }
  .result-green {
    background-color: #28a745;
  }
</style>

<!-- React Components -->
<script
  type="text/babel"
  src="{{ url_for('static', filename='react_components/VantaBackground.js') }}"
></script>
<script
  type="text/babel"
  src="{{ url_for('static', filename='react_components/Navbar.js') }}"
></script>
<script
  type="text/babel"
  src="{{ url_for('static', filename='react_components/ResultCard.js') }}"
></script>
<script>
function findNearbyHospitals() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            let lat = position.coords.latitude;
            let lon = position.coords.longitude;

            // Google Maps search for hospitals nearby
            let url = `https://www.google.com/maps/search/anemia+hospitals/@${lat},${lon},15z`;

            // Open in new tab
            window.open(url, '_blank');
        }, function(error) {
            alert("Unable to fetch your location. Please enable location services.");
        });
    } else {
        alert("Geo location is not supported by this browser.");
    }
}
</script>
{% endblock %}
